!include ..\support\Makefile.common.nt

all: tk.ml .depend

tkgen.ml: ..\Widgets.src ..\compiler\tkcompiler
	cd .. & ..\..\boot\ocamlrun compiler/tkcompiler

# dependencies are broken: wouldn't work with gmake 3.77

tk.ml .depend: tkgen.ml ..\builtin\report.ml #../builtin/builtin_*.ml
	cat << > tk.ml
open Widget
open Protocol
open Support
open Textvariable
<<
	cat ../builtin/report.ml >> tk.ml
	cat ../builtin/builtin_*.ml >> tk.ml
	cat tkgen.ml >> tk.ml
	cat << >> tk.ml


module Tkintf = struct
<<
	cat ../builtin/builtini_*.ml >> tk.ml
	cat tkigen.ml >> tk.ml
	cat << >> tk.ml
end (* module Tkintf *)


open Tkintf


<<
	cat ../builtin/builtinf_*.ml >> tk.ml
	cat tkfgen.ml >> tk.ml
	$(LABLDEP) *.mli *.ml > .depend
